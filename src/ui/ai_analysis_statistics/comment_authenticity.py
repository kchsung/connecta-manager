"""
ëŒ“ê¸€ ì§„ì •ì„± í†µê³„ ì»´í¬ë„ŒíŠ¸
"""
import streamlit as st
import plotly.express as px
from .common_functions import get_comment_authenticity_statistics

def render_comment_authenticity_statistics():
    """ëŒ“ê¸€ ì§„ì •ì„± í†µê³„"""
    st.markdown("### ğŸ’¬ ëŒ“ê¸€ ì§„ì •ì„± í†µê³„")
    
    try:
        # ëŒ“ê¸€ ì§„ì •ì„± í†µê³„ ì¡°íšŒ
        authenticity_stats = get_comment_authenticity_statistics()
        
        if not authenticity_stats:
            st.warning("ëŒ“ê¸€ ì§„ì •ì„± í†µê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
            return
        
        # ì§„ì •ì„± ë“±ê¸‰ ë¶„í¬
        st.markdown("#### ğŸ“Š ì§„ì •ì„± ë“±ê¸‰ ë¶„í¬")
        if authenticity_stats['authenticity_level_distribution']:
            fig = px.pie(
                values=list(authenticity_stats['authenticity_level_distribution'].values()),
                names=list(authenticity_stats['authenticity_level_distribution'].keys()),
                title="ëŒ“ê¸€ ì§„ì •ì„± ë“±ê¸‰ ë¶„í¬"
            )
            st.plotly_chart(fig, width='stretch')
        
        # ì§„ì •ì„± ë¹„ìœ¨ í†µê³„
        st.markdown("#### ğŸ“ˆ ì§„ì •ì„± ë¹„ìœ¨ í†µê³„")
        col1, col2, col3, col4 = st.columns(4)
        
        with col1:
            st.metric("í‰ê·  ì§„ì •ì„± ë¹„ìœ¨", f"{authenticity_stats['avg_authentic_ratio']:.1f}%")
        with col2:
            st.metric("ì¤‘ì•™ê°’ ì§„ì •ì„± ë¹„ìœ¨", f"{authenticity_stats['median_authentic_ratio']:.1f}%")
        with col3:
            st.metric("í‰ê·  ì €í’ˆì§ˆ ë¹„ìœ¨", f"{authenticity_stats['avg_low_authentic_ratio']:.1f}%")
        with col4:
            st.metric("ì¤‘ì•™ê°’ ì €í’ˆì§ˆ ë¹„ìœ¨", f"{authenticity_stats['median_low_authentic_ratio']:.1f}%")
        
        # ì§„ì •ì„± ë¹„ìœ¨ ë¶„í¬
        if authenticity_stats['authentic_ratio_distribution']:
            st.markdown("#### ğŸ“Š ì§„ì •ì„± ë¹„ìœ¨ ë¶„í¬")
            fig = px.histogram(
                x=authenticity_stats['authentic_ratio_distribution'],
                nbins=20,
                title="ì§„ì •ì„± ë¹„ìœ¨ ë¶„í¬",
                labels={'x': 'ì§„ì •ì„± ë¹„ìœ¨ (%)', 'y': 'ë¹ˆë„'}
            )
            st.plotly_chart(fig, width='stretch')
        
        # í†µê³„ í•´ì„ ê°€ì´ë“œ
        st.markdown("---")
        st.markdown("#### ğŸ’¡ ëŒ“ê¸€ ì§„ì •ì„± í†µê³„ í•´ì„ ê°€ì´ë“œ")
        
        with st.expander("ğŸ” ìƒì„¸ í•´ì„ ê°€ì´ë“œ ë³´ê¸°", expanded=False):
            st.markdown("**ğŸ“Š ê° ë¶„ì„ í•­ëª© ì„¤ëª…**")
            
            st.markdown("**ğŸ’¬ ëŒ“ê¸€ ì§„ì •ì„± ë“±ê¸‰**")
            st.markdown("ì¸í”Œë£¨ì–¸ì„œì˜ ëŒ“ê¸€ë“¤ì´ ì–¼ë§ˆë‚˜ ì§„ì •ì„± ìˆëŠ”ì§€ í‰ê°€í•œ ë“±ê¸‰ì…ë‹ˆë‹¤. ëŒ“ê¸€ì˜ ë‚´ìš© í’ˆì§ˆ, ì‘ì„±ì íŠ¹ì„±, ìƒí˜¸ì‘ìš© íŒ¨í„´ ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ 'ë§¤ìš° ë†’ìŒ', 'ë†’ìŒ', 'ë³´í†µ', 'ë‚®ìŒ', 'ë§¤ìš° ë‚®ìŒ' ë“±ìœ¼ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤.")
            
            st.markdown("**ğŸ“ˆ ì§„ì •ì„± ë¹„ìœ¨**")
            st.markdown("ì „ì²´ ëŒ“ê¸€ ì¤‘ ì§„ì •ì„± ìˆëŠ” ëŒ“ê¸€ì˜ ë¹„ìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ë†’ì€ ë¹„ìœ¨ì€ íŒ”ë¡œì›Œë“¤ì´ ì§„ì‹¬ìœ¼ë¡œ ìƒí˜¸ì‘ìš©í•˜ê³  ìˆìŒì„ ì˜ë¯¸í•˜ë©°, ë‚®ì€ ë¹„ìœ¨ì€ ë´‡ì´ë‚˜ ìŠ¤íŒ¸ ëŒ“ê¸€ì´ ë§ìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.")
            
            st.markdown("**ğŸ“‰ ì €í’ˆì§ˆ ë¹„ìœ¨**")
            st.markdown("ì „ì²´ ëŒ“ê¸€ ì¤‘ ì €í’ˆì§ˆ ëŒ“ê¸€(ìŠ¤íŒ¸, ë´‡, ë¬´ì˜ë¯¸í•œ ëŒ“ê¸€)ì˜ ë¹„ìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ ë¹„ìœ¨ì´ ë†’ì„ìˆ˜ë¡ ì¸í”Œë£¨ì–¸ì„œì˜ íŒ”ë¡œì›Œ í’ˆì§ˆì´ ë‚®ê±°ë‚˜ ì¸ìœ„ì ì¸ ìƒí˜¸ì‘ìš©ì´ ë§ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.")
            
            st.markdown("**ğŸ¯ ì§„ì •ì„± í‰ê°€ ê¸°ì¤€**")
            st.markdown("""
            - **ëŒ“ê¸€ ë‚´ìš© í’ˆì§ˆ:** ì˜ë¯¸ ìˆëŠ” ë‚´ìš©, ê´€ë ¨ì„±, ì–¸ì–´ í’ˆì§ˆ
            - **ì‘ì„±ì íŠ¹ì„±:** ê³„ì • ì‹ ë¢°ë„, í™œë™ íŒ¨í„´, íŒ”ë¡œì›Œ/íŒ”ë¡œì‰ ë¹„ìœ¨
            - **ìƒí˜¸ì‘ìš© íŒ¨í„´:** ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” íë¦„, ì ì ˆí•œ ë°˜ì‘ ì‹œê°„
            - **ìŠ¤íŒ¸/ë´‡ íƒì§€:** ë°˜ë³µì ì¸ íŒ¨í„´, ë¬´ì˜ë¯¸í•œ ë‚´ìš©, ìë™í™”ëœ ëŒ“ê¸€
            """)
            
            st.markdown("**ğŸ“Š ë¶„í¬ í•´ì„ ë°©ë²•**")
            st.markdown("""
            - **íŒŒì´ ì°¨íŠ¸:** ê° ì§„ì •ì„± ë“±ê¸‰ë³„ ì¸í”Œë£¨ì–¸ì„œ ë¶„í¬ë¥¼ ì‹œê°ì ìœ¼ë¡œ í™•ì¸
            - **íˆìŠ¤í† ê·¸ë¨:** ì§„ì •ì„± ë¹„ìœ¨ì˜ ë¶„í¬ í˜•íƒœë¥¼ í™•ì¸í•˜ì—¬ ì „ì²´ì ì¸ í’ˆì§ˆ ìˆ˜ì¤€ íŒŒì•…
            - **í†µê³„ ì§€í‘œ:** í‰ê· ê³¼ ì¤‘ì•™ê°’ì„ ë¹„êµí•˜ì—¬ ë¶„í¬ì˜ íŠ¹ì„± ì´í•´
            - **ë¹„ìœ¨ ë¶„ì„:** ì§„ì •ì„± ë¹„ìœ¨ê³¼ ì €í’ˆì§ˆ ë¹„ìœ¨ì„ í•¨ê»˜ ë¶„ì„í•˜ì—¬ ì¢…í•©ì ì¸ ëŒ“ê¸€ í’ˆì§ˆ í‰ê°€
            """)
            
            st.markdown("**ğŸ’¡ í™œìš© ë°©ì•ˆ**")
            st.markdown("""
            - **ì¸í”Œë£¨ì–¸ì„œ ì„ ë³„:** ì§„ì •ì„± ë¹„ìœ¨ì´ ë†’ì€ ì¸í”Œë£¨ì–¸ì„œë¥¼ ìš°ì„ ì ìœ¼ë¡œ í˜‘ì—… ëŒ€ìƒìœ¼ë¡œ ê³ ë ¤
            - **ë§ˆì¼€íŒ… ì „ëµ:** ì €í’ˆì§ˆ ëŒ“ê¸€ì´ ë§ì€ ì¸í”Œë£¨ì–¸ì„œëŠ” ì‹ ì¤‘í•˜ê²Œ ê²€í† 
            - **ë¸Œëœë“œ ì•ˆì „ì„±:** ì§„ì •ì„± ìˆëŠ” ìƒí˜¸ì‘ìš©ì„ í†µí•´ ë¸Œëœë“œ ì´ë¯¸ì§€ ë³´í˜¸
            - **ì„±ê³¼ ì˜ˆì¸¡:** ì§„ì •ì„± ë¹„ìœ¨ì´ ë†’ì€ ì¸í”Œë£¨ì–¸ì„œì¼ìˆ˜ë¡ ì‹¤ì œ ë§ˆì¼€íŒ… ì„±ê³¼ê°€ ì¢‹ì„ ê°€ëŠ¥ì„± ë†’ìŒ
            """)
    
    except Exception as e:
        st.error(f"ëŒ“ê¸€ ì§„ì •ì„± í†µê³„ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜: {str(e)}")
